#!/usr/bin/env python2
import sys
import argparse
import sldb.common.config as config

if __name__ == '__main__':
    parser = config.get_base_arg_parser(
        'Collapses sequences at a given level.  Collapsing at the \'sample\' '
        'or \'clone\' level will erase higher-level collapsing information '
        'of affected rows.', multiproc=True)
    parser.add_argument('level', help='Level to collapse (\'sample\', '
                        '\'subject\', or \'clone\')')
    parser.add_argument('--ids', nargs='+', default=None, type=int,
                        help='ID(s) to collapse.  The IDs must correspond '
                        'to the selected \'level\'.')

    args = parser.parse_args()
    if args.level not in ('sample', 'subject', 'clone'):
        parser.error('Collapse level must be \'sample\', ' '\'subject\', or '
                     '\'clone\'')

    session = config.init_db(args.master_db_config, args.data_db_config)
    from sldb.aggregation.collapse import run_collapse
    sys.exit(run_collapse(session, args))
