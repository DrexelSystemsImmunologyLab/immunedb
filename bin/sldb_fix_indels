#!/usr/bin/env python2
import sys
import argparse

import sldb.common.config as config
from sldb.identification.local_align import run_fix_indels

if __name__ == '__main__':
    parser = config.get_base_arg_parser('Attempts to fix indels.',
            multiproc=True)
    parser.add_argument('v_germlines', help='FASTA file with IMGT gapped '
                        'V-gene germlines')
    parser.add_argument('j_germlines', help='FASTA file with J-gene '
                        'germlines. The final nucleotide in all genes must be '
                        'aligned. Sequence cannot contain any gaps.')
    parser.add_argument('upstream_of_cdr3', type=int, help='The number of '
                        ' nucleotides in the J germlines upstream of the CDR3')
    parser.add_argument('anchor_len', type=int, help='The number of '
                        'nucleotides at the end of the J germlines to use as '
                        'anchors.')
    parser.add_argument('min_anchor_len', type=int, help='The minimum number '
                        'of nucleotides in the J germline anchors required '
                        'to match the sequence.')
    args = parser.parse_args()

    session = config.init_db(args.db_config)
    sys.exit(run_fix_indels(session, args))
